apiVersion: v1
kind: ConfigMap
metadata:
  name: perplexica-config
  namespace: productivity
data:
  config.toml: |
    [GENERAL]
    PORT = 3001
    SIMILARITY_MEASURE = "cosine"

    [API_KEYS]
    OPENAI = ""
    GROQ = ""
    ANTHROPIC = ""

    [API_ENDPOINTS]
    SEARXNG = "http://searxng.productivity.svc.cluster.local:8080"
    OLLAMA = "http://open-webui-ollama.ai.svc.cluster.local:11434"
  Caddyfile: |
    :2222 {
      respond "Hello, world!"
    }

    :80 {
      @websockets {
        header Connection *Upgrade*
        header Upgrade    websocket
      }

      reverse_proxy @websockets perplexica-backend.productivity.svc.cluster.local:3001
      reverse_proxy /api/* perplexica-backend.productivity.svc.cluster.local:3001
      reverse_proxy /api perplexica-backend.productivity.svc.cluster.local:3001
      reverse_proxy perplexica-frontend.productivity.svc.cluster.local:3000
    }
