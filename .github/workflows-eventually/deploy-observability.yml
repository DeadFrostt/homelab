name: Deploy Observability configuration

on: # yamllint disable-line rule:truthy
  push:
    paths:
      - docker/observability/config/*
      - docker/observability/tasks.yml
      - .github/workflows/deploy-observability.yml
    branches:
      - main

jobs:
  deploy:
    name: Deploy Observability configuration
    runs-on: self-hosted
    steps:
      - name: Update Repository
        run: |
          cd /homelab
          git reset --hard HEAD
          git pull
      - name: Get most recent secrets
        run: |
          cd /homelab
          cp ~/homelab-secrets.env /homelab/.env
      - name: Produce Observability Configuration
        run: |
          cd /homelab
          task docker:observability:produce
      - name: Deploy Observability configuration
        run: |
          cd /homelab
