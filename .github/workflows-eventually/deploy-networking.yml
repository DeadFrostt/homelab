name: Deploy Networking configuration

on: # yamllint disable-line rule:truthy
  push:
    paths:
      - docker/networking/config/*
      - docker/networking/tasks.yml
      - .github/workflows/deploy-networking.yml
    branches:
      - main

jobs:
  deploy:
    name: Deploy Networking configuration
    runs-on: self-hosted
    steps:
      - name: Update Repository
        run: |
          cd /homelab
          git reset --hard HEAD
          git pull
      - name: Get most recent secrets
        run: |
          cd /homelab
          cp ~/homelab-secrets.env /homelab/.env
      - name: Produce Networking Configuration
        run: |
          cd /homelab
          task docker:networking:produce
      - name: Deploy Networking configuration
        run: |
          cd /homelab
